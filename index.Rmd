
---
title: "Neighborhood Disadvantage and Crime Variation Over Time"
author: "Olivia Delos"
---

# Introduction
Crime rates have decreased for all types of crime since the 1990s, although most considerably for violent crimes (Papachristos 2013). However, crime rates vary depending on the social composition of a neighborhood. Disadvantaged neighborhoods are disproportionately low-income with weak social ties and high residential instability, attributes often correlated with crime (Zuberi 2012). The concentration of poverty, violence, and high policing in disadvantaged neighborhoods hinders residents’ ability to form social cohesion and community organization, increasing residents’ risk of victimization (Van Wilsem, Wittebrood, De Graaf 2006). Violent crime, in particular, is more prevalent in urban, disadvantaged neighborhoods (Friedson and Sharkey 2015).  However, few studies have examined whether the relationship between neighborhood disadvantage and crime varies by crime type. It is also well known that neighborhoods with a high immigrant population have lower crime rates (Adelman 2019). Buffalo's Waterfront Area has a high immigrant population and has undergone recent developments aimed at resurgence (Adelman 2019). Elmwood Village has also seen continuous development. In order to determine whether recent developments infuence crime rates, I look at crime trends for these two areas as well as the entire city of Buffalo. By examining census data and crime data I answer four questions: 1) Has crime decreased in Buffalo, NY since 2010? 2) If so, does the decrease differ by crime type? 3) Has this decrease occurred more substantially in areas with a high immigrant population or areas that have undergone recent development (Elmwood Village and Waterfront Area)? 4) Does the relationship between median income and crime vary by crime type? To answer my questions, I compare crime rates by type of crime incident between 2010 to crime rates in 2017. I measure neighborhood disadvantage using census tract data in Buffalo, New York on median income from the 2010 and 2017 ACS. Crime data comes from OpenData Buffalo and can be broken into five categories: assault, breaking and entering, homicide, sexual offenses, and theft. I hypothesize that there will be a decrease in crime rates from 2010 to 2017 for all tracts, but more noticeably for violent crimes, as opposed to property crimes and that this decrease will be more substantial when examining developed neighborhoods. I also predict that the relationship between median income and crime will be greater for violent crimes. 


# Materials and methods

1. Load required packages
2. Download crime data from OpenDataBuffalo and 2010 and 2017 ACS estimates for income data in Erie County
3. Clean and join data
4. Run regression on types of crime and income level
5. Create figures

## 1. Load required packages.
```{r, message=F, warning=F}
rm(list=ls())
library(tidycensus)
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(lubridate)
library(seg)
library(sf)
library(tigris)
library(gridExtra)
library(spgwr)
```

## 2. Download the data

```{r, results="hide", cache = TRUE, message=F, warning=F}
#Load crime data
crimesf=read_sf("https://data.buffalony.gov/api/geospatial/d6g9-xbgu?method=export&format=GeoJSON")

#Load 2017 census data
v17 <- load_variables(year = 2017, dataset = "acs5", cache = TRUE)

med_income2017 <- get_acs(geography = "tract",
                        variables = c(medianinc = "B06011_001"),
                       state = "NY",
                       county = "Erie",
                       year = 2017,
                       geometry = TRUE)

totalpop2017 <- get_acs(geography = "tract",
                        variables = c(totalpop = "B01003_001"),
                       state = "NY",
                       county = "Erie",
                       year = 2017,
                       geometry = TRUE)


# Load 2010 census data
v10 <- load_variables(year = 2010, dataset = "acs5", cache = TRUE)

med_income2010 <- get_acs(geography = "tract",
                        variables = "B19013_001",
                       state = "NY",
                       county = "Erie",
                       year = 2010,
                       geometry = TRUE)

totalpop2010 <- get_acs(geography = "tract",
                        variables = c(totalpop = "B01003_001"),
                       state = "NY",
                       county = "Erie",
                       year = 2010,
                       geometry = TRUE)


```
Crop census data to Buffalo city limits
``` {r, results = "hide", cache = TRUE, message=F, warning=F}

#Crop census data to city limits
income_crop2017 <- med_income2017[c(1:70, 228, 229, 221:227),]
income_crop2010 <- med_income2010[c(1:70, 228, 229, 221:227),]
totalpop17 <- totalpop2017[c(1:70, 228, 229, 221:227),]
totalpop10 <- totalpop2010[c(1:70, 228, 229, 221:227),]

#Transform crime geometry to match census tract
crimetrans <- st_transform(crimesf, st_crs(income_crop2017))

inc_tracts <- st_join(crimetrans, select(med_income2017,NAME), st_intersects)
```

## 3. Clean crime data
```{r, cache = TRUE,results="hide"}
#extract year from date
crime_date <- ymd_hms(inc_tracts$incident_datetime) %>%
    year()
  
crime_year <- cbind(crime_date, inc_tracts, stringsAsFactors = FALSE)

#Recategorize crime types
crime_year$parent_incident_type <- as.factor(crime_year$parent_incident_type) %>%
  fct_collapse(crime_year$parent_incident_type, 
                  Theft = c("Theft of Vehicle", "Theft", "Robbery"),
                  Sexual_Offenses = c("Sexual Assault", "Other Sexual Offense"),
                  Breaking_entering = "Breaking & Entering",
                  Assault = "Assault",
                  Homicide = "Homicide")

#clean/filter crime data, drop geometry
crime2017 <- crime_year %>%
     filter(crime_date == 2017) %>%
     group_by(NAME, parent_incident_type) %>%
    summarize(total = n()) %>%
    st_set_geometry(NULL)


c2017_spread <- spread(crime2017, parent_incident_type, total)

c2017_spread[is.na(c2017_spread)] <- 0

#Do the same for 2010
crime2010 <- crime_year %>%
     filter(crime_date == 2010) %>%
     group_by(NAME, parent_incident_type) %>%
    summarize(total = n()) %>%
    st_set_geometry(NULL)

c2010_spread <- spread(crime2010, parent_incident_type, total)

c2010_spread[is.na(c2010_spread)] <- 0

```

Clean income data and join datasets
```{r, cache = TRUE}
#Remove and rename columns
income_clean17 <- income_crop2017 %>%
  select(-moe, -variable, -GEOID)

income_clean10 <- income_crop2010 %>%
  select(-moe, -variable, -GEOID)

pop2017_clean <- totalpop17 %>%
  select(-moe, -variable, -GEOID)
  
pop2010_clean <- totalpop10 %>%
  select(-moe, -variable, -GEOID)

colnames(income_clean10)[2] <- "MedianInc"
colnames(income_clean17)[2] <- "MedianInc"
colnames(pop2017_clean)[2] <- "Population"
colnames(pop2010_clean)[2] <- "Population"

#Join income and crime spread
crime_income2017 <- left_join(income_clean17, c2017_spread, by = c("NAME" = "NAME"))
crime_income2010 <- left_join(income_clean10, c2010_spread, by = c("NAME" = "NAME"))

#Join income and population
inc_pop2017 <- cbind(income_clean17, pop2017_clean) %>%
  select(-NAME.1, -geometry.1)

inc_pop2010 <- cbind(income_clean10, pop2010_clean) %>%
  select(-NAME.1, -geometry.1)
```

Calculate avg crime rate per person
```{r,cache=TRUE,message=F,warning=F}
#Find mean total crime per tract
crimeAvg2017 <- crime_income2017 %>%
  group_by(NAME, MedianInc) %>%
  summarize(meancrime = mean(c(Assault, Breaking_entering, Sexual_Offenses, Theft)))

crimeAvg2010 <- crime_income2010 %>%
  group_by(NAME, MedianInc) %>%
  summarize(meancrime = mean(c(Assault, Breaking_entering, Sexual_Offenses, Theft)))

#Calculate crime rate per population
cpp17 <- crimeAvg2017[ order(match(crimeAvg2017$NAME, inc_pop2017$NAME)),]
cpp10 <- inc_pop2010[ order(match(inc_pop2010$NAME, crimeAvg2010$NAME)),]
  
crime_pop2017 <- cbind(inc_pop2017, crimeAvg2017) %>%
  select(-MedianInc.1, -geometry.1, -NAME.1)

crime_pop2010 <- cbind(inc_pop2017, crimeAvg2010) %>%
  select(-MedianInc.1, -geometry.1, -NAME.1)


cpp2017 <- crime_pop2017 %>%
  mutate(AvgCPC = (meancrime/Population))

cpp2010 <- crime_pop2010 %>%
  mutate(AvgCPC = (meancrime/Population))
```

Join population data with crime data
```{r, message=F, warning=F}
#Join population and crime_spread 2010
crimetype_pop10 <- cbind(crime_income2010, pop2010_clean)

avghom2010 <- crimetype_pop10 %>%
  mutate(AvgHom = (Homicide/Population))

avgAss2010 <- crimetype_pop10 %>%
  mutate(AvgAssault = (Assault/Population))

avgBE2010 <- crimetype_pop10 %>%
  mutate(AvgBreaking_entering = (Breaking_entering/Population))

avgTheft2010 <- crimetype_pop10 %>%
  mutate(AvgTheft = (Theft/Population))

avgSO2010 <- crimetype_pop10 %>%
  mutate(avgSO = (Sexual_Offenses/Population))

#Join population and crime_spread 2017
crimetype_pop17 <- cbind(crime_income2017, pop2017_clean)

avghom2017 <- crimetype_pop17 %>%
  mutate(AvgHom = (Homicide/Population))

avgAss2017 <- crimetype_pop17 %>%
  mutate(AvgAssault = (Assault/Population))

avgBE2017 <- crimetype_pop17 %>%
  mutate(AvgBreaking_entering = (Breaking_entering/Population))

avgTheft2017 <- crimetype_pop17 %>%
  mutate(AvgTheft = (Theft/Population))

avgSO2017 <- crimetype_pop17 %>%
  mutate(avgSO = (Sexual_Offenses/Population))
```


Clean crime data for time series analysis
```{r}
# Clean for all of Buffalo
crimeALL <- crime_year %>%
     filter(crime_date >= 2010 & crime_date <= 2017) %>%
     group_by(NAME, parent_incident_type, crime_date) %>%
    summarize(total = n()) %>%
    st_set_geometry(NULL)

# Don't group by tract name for overall time series
crimeALLplot <- crime_year %>%
  filter(crime_date >= 2010 & crime_date <= 2017) %>%
     group_by(parent_incident_type, crime_date) %>%
    summarize(total = n()) %>%
    st_set_geometry(NULL)
  
# crop crimeALL for Elmwood tracts
elmwoodcrop <- crimeALL[c(569:600,2301:2571),]

elmwood <- elmwoodcrop %>%
  group_by(parent_incident_type, crime_date) %>%
  spread(parent_incident_type, total)

elmwood[is.na(elmwood)] <- 0

elmwoodavg <- summarize(elmwood, avg = mean(c(Assault, Breaking_entering, Sexual_Offenses, Homicide, Theft)))


# Crop for waterfront tracts 
waterfrontcrop <- crimeALL[c(2263:2300,2572:2642,2675:2810,574:710),]

# Clean for waterfront
waterfront <- waterfrontcrop %>%
  group_by(parent_incident_type, crime_date) %>%
  spread(parent_incident_type, total)

waterfront[is.na(waterfront)] <- 0

waterfrontavg <- summarize(waterfront, avg = mean(c(Assault, Breaking_entering, Sexual_Offenses, Homicide, Theft)))

```
## 4. Run regression/plot the relationship between crime and median income
Plot relationship between crime and income
```{r, results='asis', cache = TRUE, message=F, warning=F}
#2010 plot
ggplot(cpp2010) + geom_point(aes(x = MedianInc, y = AvgCPC)) +
  labs(x = "Median Income 2010", y = "Average Crime Per Capita 2010", title = "Relationship between Median Income and Crime Per Capita in 2010")

#2017 plot
ggplot(cpp2017) + geom_point(aes(x = MedianInc, y = AvgCPC)) +
  labs(x = "Median Income 2017", y = "Average Crime Per Capita 2017", title = "Relationship between Median Income and Crime Per Capita in 2017")

```

Relationship between crime and income 2010
```{r}
#2010 regression
Assault2010_reg <- lm(Assault~MedianInc, data = crimetype_pop10)
summary(Assault2010_reg)

Theft2010_reg <- lm(Theft~MedianInc, data = crimetype_pop10)
summary(Theft2010_reg)

BE2010_reg <- lm(Breaking_entering~MedianInc, data = crimetype_pop10)
summary(BE2010_reg)

#No correlation
SO2010_reg <- lm(Sexual_Offenses~MedianInc, data = crimetype_pop10)
summary(SO2010_reg)

#Highest correlation
Hom2010_reg <- lm(Homicide~MedianInc, data = crimetype_pop10)
summary(Hom2010_reg)

```

Relationship between crime and income 2017
```{r}
#2017 regression
Assault2017_reg <- lm(Assault~MedianInc, data = crimetype_pop17)
summary(Assault2017_reg)

Theft2017_reg <- lm(Theft~MedianInc, data = crimetype_pop17)
summary(Theft2017_reg)

BE2017_reg <- lm(Breaking_entering~MedianInc, data = crimetype_pop17)
summary(BE2017_reg)

#No correlation
SO2017_reg <- lm(Sexual_Offenses~MedianInc, data = crimetype_pop17)
summary(SO2017_reg)

#Highest correlation
Hom2017_reg <- lm(Homicide~MedianInc, data = crimetype_pop17)
summary(Hom2017_reg)
```

# Results


##5. Create figures
Plot median income and crime per capita for 2010 and 2017

```{r, fig.width=10, fig.height=5, fig.cap="Crime Over Time"}
ggplot(crimeALLplot) + geom_line(aes(x = crime_date, y = total, color = parent_incident_type)) + 
  labs(x = "Year", y = "Total crime", color = "Crime type", title = "Crime Frequency Over Time")
```

```{r, fig.width=10, fig.height=5, fig.cap="Average crime between 2010 and 2017 in Elmwood Village"}
ggplot(elmwoodavg) + geom_line(aes(x = crime_date, y = avg)) + 
  labs(x = "Year", y = "Average Crime Rate", title = "Average Crime Rate Over Time in Elmwood Village")
```


```{r, fig.width=10, fig.height=5, fig.cap="Average crime between 2010 and 2017 in Buffalo's Waterfront Area"}
ggplot(waterfrontavg) + geom_line(aes(x = crime_date, y = avg)) + 
  labs(x = "Year", y = "Average Crime Rate", title = "Average Crime Rate Over Time in Buffalo's Waterfront Area")
```

This figure is a map of median income and average crime per capita for 2010 by census tract in Buffalo, NY
```{r, fig.width=10, fig.height=5, fig.cap="2010 Income and Crime"}

mapinc10 <- ggplot(cpp2010) + geom_sf(aes(fill = MedianInc)) +
  scale_fill_viridis_c() + labs(fill = "Median Income", title = "Median Income 2010") +
  theme(panel.background = element_blank())

mapcrime10 <- ggplot(cpp2010) + geom_sf(aes(fill = AvgCPC)) + 
  scale_fill_viridis_c() + labs(fill = "Average CPC", title = "Crime Per Capita 2010") +
  theme(panel.background = element_blank())

grid.arrange(mapinc10, mapcrime10, nrow = 1)

```

This figure is a map of median income and average crime per capita for 2017 by census tract in Buffalo, NY
```{r, fig.width=10, fig.height=5, fig.cap="2017 Income and Crime"}
mapinc17 <- ggplot(cpp2017) + geom_sf(aes(fill = MedianInc)) +
  scale_fill_viridis_c() + labs(fill = "Median Income", title = "Median Income 2017") + 
  theme(panel.background = element_blank())

mapcrime17 <- ggplot(cpp2017) + geom_sf(aes(fill = AvgCPC)) + 
  scale_fill_viridis_c() + labs(fill = "Average CPC") +
  theme(panel.background = element_blank())

grid.arrange(mapinc17, mapcrime17, nrow = 1)
```

## Plot crime by type

```{r,fig.width=10, fig.height=5, fig.cap="Homicide 2010"}

hom2010map <- ggplot(avghom2010) + geom_sf(aes(fill = AvgHom)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Homicide PC", title = "Homicide Per Capita 2010")

grid.arrange(mapinc10, hom2010map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Homicide 2017"}

hom2017map <- ggplot(avghom2017) + geom_sf(aes(fill = AvgHom)) + scale_fill_viridis_c() +
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Homicide PC", title = "Homicide Per Capita 2017")

grid.arrange(mapinc17, hom2017map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Assault2010"}
assault2010map <- ggplot(avgAss2010) + geom_sf(aes(fill = AvgAssault)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Assault PC", title = "Assault Per Capita 2010")

grid.arrange(mapinc10, assault2010map, nrow = 1)

```


```{r,fig.width=10, fig.height=5, fig.cap="Assault2017"}
assault2017map <- ggplot(avgAss2017) + geom_sf(aes(fill = AvgAssault)) + scale_fill_viridis_c() +
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Assault PC", title = "Assault Per Capita 2017")

grid.arrange(mapinc17, assault2017map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Breaking & Entering 2010"}
be2010map <- ggplot(avgBE2010) + geom_sf(aes(fill = AvgBreaking_entering)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Break&Ent. PC", title = "Breaking & Entering Per Capita 2010")

grid.arrange(mapinc10, be2010map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Breaking & Entering 2017"}
be2017map <- ggplot(avgBE2017) + geom_sf(aes(fill = AvgBreaking_entering)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Break&Ent. PC", title = "Breaking & Entering Per Capita 2017")

grid.arrange(mapinc17, be2017map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Theft 2010"}
theft2010map <- ggplot(avgTheft2010) + geom_sf(aes(fill = AvgTheft)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Theft PC", title = "Theft Per Capita 2010")

grid.arrange(mapinc10, theft2010map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Theft 2017"}
theft2017map <- ggplot(avgTheft2017) + geom_sf(aes(fill = AvgTheft)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Theft PC", title = "Theft Per Capita 2010")

grid.arrange(mapinc17, theft2017map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Sexual Offenses 2010"}
so2010map <- ggplot(avgSO2017) + geom_sf(aes(fill = avgSO)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Sex. Off. PC", title  = "Sexual Offenses Per Capita 2010")

grid.arrange(mapinc10, so2010map, nrow = 1)
```


```{r,fig.width=10, fig.height=5, fig.cap="Sexual Offenses 2017"}
so2017map <- ggplot(avgSO2017) + geom_sf(aes(fill = avgSO)) + scale_fill_viridis_c() + 
  theme(panel.background = element_blank()) +
  labs(fill = "Avg Sex. Off. PC", title  = "Sexual Offenses Per Capita 2017")

grid.arrange(mapinc17, so2017map, nrow = 1)
```

# Conclusions

Overall, crime has decreased in Buffalo, NY. Contrary to my hypothesis, crime has decreased most steadily for theft and breaking and entering, as opposed to violent crimes. By examining two areas of Buffalo (Elmwood Village and the Waterfront Area) that have undergone recent development aimed at improving neighborhood conditions, it is evident that these areas have experienced a substantial decrease in crime since 2010, likely as a result of these developments, as well as the high immigrant population (Adelman et al. 2019).There is a moderate relationship between crime and median income. Median income is significantly associated with assault, breaking and entering, sexual offenses, and homicide in 2010 and assault, breaking and entering, and homicide in 2017.
In support of my hypothesis, median income has a higher correlation with violent crimes than property crimes for both 2010 and 2017. The relationship between income and crime appears to be higher when examining 2017 data, possibly due to increasing gentrification and thus concentrated disadvantage in these areas, although more research needs to be done to determine if this is the case. In summary, median income plays a role in the level of crime in an area, but there are likely other social conditions as well influencing crime rates in Buffalo, NY.

# References

OpenDataBuffalo. https://data.buffalony.gov/Public-Safety/Crime-Incidents/d6g9-xbgu

Adelman, Robert M., Aysegul Balta Ozgen, and Watoii Rabii. 2019. "Buffalo's West Side Story: Migration, Gentrification, and Neighborhood Change." *City & Community* 1-22.
Friedson, Michael and Patrick Sharkey. 2015. "Violence and Neighborhood Disadvantage after the Crime Decline." *The American Academy of Political & Social Science* 660. 

Papachristos, Andrew V. 2013. "48 Years of Crime in Chicago: A Descriptive Analysis of Serious Crime Trends from 1965 to 2013." *Institution for Social and Policy Studies*. 

U.S. Census Bureau 2010, 2017....

Van Wilsem, Johan. Karin Whitebrood, Nan Dirk De Graaf. 2006. "Socioeconomic Dynamics of Neighborhoods and the Risk of Crime Victimization: A Multilevel Study of Improving, Declining, and Stable Areas in the Netherlands." *Social Problems* 53(2):226-247.

Zuberi, Anita. 2012. “Neighborhood Poverty and Children’s Exposure to Danger: Examining Gender Differences in Impacts of the Moving to Opportunity Experiment.” *Social Science Research* 41:788-801.